2025-02-24 12:53:36,136 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Starting topology monitoring"}
2025-02-24 12:53:36,136 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "previousDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "message": "Topology description changed"}
2025-02-24 12:53:36,136 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "serverHost": "localhost", "serverPort": 27017, "message": "Starting server monitoring"}
2025-02-24 12:53:36,137 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection pool created", "serverHost": "localhost", "serverPort": 27017}
2025-02-24 12:53:36,143 - INFO - Début du traitement pour l'événement GPF et l'année 2025
2025-02-24 12:53:36,143 - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}}
2025-02-24 12:53:36,143 - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "remainingTimeMS": 29}
2025-02-24 12:53:36,154 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "driverConnectionId": 1, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "message": "Server heartbeat started"}
2025-02-24 12:53:36,155 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "driverConnectionId": 1, "serverConnectionId": 1556, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 0.9888997301459312, "reply": "{\"helloOk\": true, \"ismaster\": true, \"topologyVersion\": {\"processId\": {\"$oid\": \"678d2a225e8eb1507fbdf654\"}}, \"maxBsonObjectSize\": 16777216, \"maxMessageSizeBytes\": 48000000, \"maxWriteBatchSize\": 100000, \"localTime\": {\"$date\": \"2025-02-24T11:53:36.155Z\"}, \"logicalSessionTimeoutMinutes\": 30, \"connectionId\": 1556, \"maxWireVersion\": 25, \"ok\": 1.0}", "message": "Server heartbeat succeeded"}
2025-02-24 12:53:36,156 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection pool ready", "serverHost": "localhost", "serverPort": 27017}
2025-02-24 12:53:36,156 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "previousDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0009888997301459312>]>", "message": "Topology description changed"}
2025-02-24 12:53:36,156 - DEBUG - {"message": "Server selection succeeded", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 67bc5dc0460e93dfa834a3f9, topology_type: Single, servers: [<ServerDescription ('localhost', 27017) server_type: Standalone, rtt: 0.0009888997301459312>]>", "clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "serverHost": "localhost", "serverPort": 27017}
2025-02-24 12:53:36,157 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection checkout started", "serverHost": "localhost", "serverPort": 27017}
2025-02-24 12:53:36,157 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "driverConnectionId": 1, "serverConnectionId": 1556, "serverHost": "localhost", "serverPort": 27017, "awaited": true, "message": "Server heartbeat started"}
2025-02-24 12:53:36,158 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection created", "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}
2025-02-24 12:53:36,171 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection ready", "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.000668100081384182}
2025-02-24 12:53:36,171 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection checked out", "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1, "durationMS": 0.013971900101751089}
2025-02-24 12:53:36,171 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Command started", "command": "{\"find\": \"parametrages\", \"filter\": {\"event\": \"GPF\", \"year\": \"2025\"}, \"limit\": 1, \"singleBatch\": true, \"lsid\": {\"id\": {\"$binary\": {\"base64\": \"5bzmLRSkQqivUsZWvIgQ2A==\", \"subType\": \"04\"}}}, \"$db\": \"titan_dev\"}", "commandName": "find", "databaseName": "titan_dev", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 1558, "serverHost": "localhost", "serverPort": 27017}
2025-02-24 12:53:36,178 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Command succeeded", "durationMS": 7.0569999999999995, "reply": "{\"cursor\": {\"firstBatch\": [{\"_id\": {\"$oid\": \"67825e7282d79d24a49bc2ca\"}, \"year\": \"2025\", \"event\": \"GPF\", \"data\": {\"globalHoraires\": {\"center\": [{\"closeTime\": \"20:00\", \"date\": \"2025-05-07\", \"openTime\": \"08:30\"}, {\"closeTime\": \"21:30\", \"date\": \"2025-05-08\", \"openTime\": \"07:30\"}, {\"closeTime\": \"20:00\", \"date\": \"2025-05-09\", \"openTime\": \"07:30\"}, {\"closeTime\": \"13:00\", \"date\": \"2025-05-10\", \"openTime\": \"07:00\"}], \"dates\": [{\"closeTime\": \"00:00\", \"date\": \"2025-05-08\", \"openTime\": \"08:00\"}, {\"closeTime\": \"23:59\", \"date\": \"2025-05-09\", \"is24h\": true, \"openTime\": \"00:00\"}, {\"closeTime\": \"23:59\", \"date\": \"2025-05-10\", \"is24h\": true, \"openTime\": \"00:00\"}, {\"closeTime\": \"17:00\", \"date\": \"2025-05-11\", \"openTime\": \"00:00\"}], \"endBadge\": \"2025-05-09T16:00:00.000Z\", \"helpDesk\": {\"closeTime\": \"14:00\", \"end\": \"2025-05-10\", \"openTime\": \"07:00\", \"start\": \"2025-05-04\"}, \"marshall\": \"2025-05-08T06:00:00.000Z\", \"montage\": {\"end\": \"2025-05-07T18:00:00.000Z\", \"start\": \"2025-04-28T05:00:00.000Z\"}, \"pcAuthoriti...", "commandName": "find", "databaseName": "titan_dev", "requestId": 18467, "operationId": 18467, "driverConnectionId": 1, "serverConnectionId": 1558, "serverHost": "localhost", "serverPort": 27017}
2025-02-24 12:53:36,181 - DEBUG - {"clientId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "message": "Connection checked in", "serverHost": "localhost", "serverPort": 27017, "driverConnectionId": 1}
2025-02-24 12:53:36,181 - INFO - Début du traitement du document de paramétrage pour GPF 2025
2025-02-24 12:53:36,181 - INFO - Traitement de globalHoraires
2025-02-24 12:53:36,181 - DEBUG - Generating vignettes for Centre accréditation on 2025-05-07: open='08:30', close='20:00'
2025-02-24 12:53:36,183 - DEBUG - Durée calculée entre 08:30 et 20:00 : 11:30
2025-02-24 12:53:36,183 - DEBUG - Vignette Ouverture générée: {'date': '2025-05-07', 'start': '08:30', 'end': '20:00', 'duration': '11:30', 'category': 'Accreditations', 'activity': 'Ouverture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-07_08:30'}
2025-02-24 12:53:36,183 - DEBUG - Vignette Fermeture générée: {'date': '2025-05-07', 'start': '', 'end': '20:00', 'duration': '11:30', 'category': 'Accreditations', 'activity': 'Fermeture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-07_08:30'}
2025-02-24 12:53:36,183 - DEBUG - Generating vignettes for Centre accréditation on 2025-05-08: open='07:30', close='21:30'
2025-02-24 12:53:36,183 - DEBUG - Durée calculée entre 07:30 et 21:30 : 14:00
2025-02-24 12:53:36,183 - DEBUG - Vignette Ouverture générée: {'date': '2025-05-08', 'start': '07:30', 'end': '21:30', 'duration': '14:00', 'category': 'Accreditations', 'activity': 'Ouverture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-08_07:30'}
2025-02-24 12:53:36,183 - DEBUG - Vignette Fermeture générée: {'date': '2025-05-08', 'start': '', 'end': '21:30', 'duration': '14:00', 'category': 'Accreditations', 'activity': 'Fermeture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-08_07:30'}
2025-02-24 12:53:36,183 - DEBUG - Generating vignettes for Centre accréditation on 2025-05-09: open='07:30', close='20:00'
2025-02-24 12:53:36,183 - DEBUG - Durée calculée entre 07:30 et 20:00 : 12:30
2025-02-24 12:53:36,183 - DEBUG - Vignette Ouverture générée: {'date': '2025-05-09', 'start': '07:30', 'end': '20:00', 'duration': '12:30', 'category': 'Accreditations', 'activity': 'Ouverture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-09_07:30'}
2025-02-24 12:53:36,183 - DEBUG - Vignette Fermeture générée: {'date': '2025-05-09', 'start': '', 'end': '20:00', 'duration': '12:30', 'category': 'Accreditations', 'activity': 'Fermeture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-09_07:30'}
2025-02-24 12:53:36,183 - DEBUG - Generating vignettes for Centre accréditation on 2025-05-10: open='07:00', close='13:00'
2025-02-24 12:53:36,184 - DEBUG - Durée calculée entre 07:00 et 13:00 : 06:00
2025-02-24 12:53:36,184 - DEBUG - Vignette Ouverture générée: {'date': '2025-05-10', 'start': '07:00', 'end': '13:00', 'duration': '06:00', 'category': 'Accreditations', 'activity': 'Ouverture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-10_07:00'}
2025-02-24 12:53:36,184 - DEBUG - Vignette Fermeture générée: {'date': '2025-05-10', 'start': '', 'end': '13:00', 'duration': '06:00', 'category': 'Accreditations', 'activity': 'Fermeture Centre accréditation', 'place': 'Centre accréditation', 'department': 'SAFE', 'type': 'Organization', 'origin': 'paramétrage', 'remark': '', 'param_id': 'center_2025-05-10_07:00'}
2025-02-24 12:53:36,184 - DEBUG - Generating vignettes for au public on 2025-05-08: open='08:00', close='00:00'
2025-02-24 12:53:36,184 - DEBUG - Durée calculée entre 08:00 et 00:00 : 16:00
2025-02-24 12:53:36,184 - DEBUG - Pour au public, fermeture déplacée au 2025-05-09
2025-02-24 12:53:36,184 - DEBUG - Vignette Ouverture générée: {'date': '2025-05-08', 'start': '08:00', 'end': '', 'duration': '16:00', 'category': 'General', 'activity': 'Ouverture au public', 'place': 'Controle', 'department': 'SAFE', 'type': 'Timetable', 'origin': 'paramétrage', 'remark': 'Fermeture prévue: 2025-05-09 00:00', 'param_id': 'dates_2025-05-08_08:00'}
2025-02-24 12:53:36,184 - DEBUG - Vignette Fermeture générée: {'date': '2025-05-09', 'start': '', 'end': '00:00', 'duration': '16:00', 'category': 'General', 'activity': 'Fermeture au public', 'place': 'Controle', 'department': 'SAFE', 'type': 'Timetable', 'origin': 'paramétrage', 'remark': '', 'param_id': 'dates_2025-05-08_08:00'}
2025-02-24 12:53:36,184 - INFO - Ignoré globalHoraires.dates pour 2025-05-09 (is24h/closed)
2025-02-24 12:53:36,184 - INFO - Ignoré globalHoraires.dates pour 2025-05-10 (is24h/closed)
2025-02-24 12:53:36,184 - DEBUG - Generating vignettes for au public on 2025-05-11: open='00:00', close='17:00'
2025-02-24 12:53:36,184 - DEBUG - Durée calculée entre 00:00 et 17:00 : 17:00
2025-02-24 12:53:36,184 - DEBUG - Vignette Ouverture générée: {'date': '2025-05-11', 'start': '00:00', 'end': '17:00', 'duration': '17:00', 'category': 'General', 'activity': 'Ouverture au public', 'place': 'Controle', 'department': 'SAFE', 'type': 'Timetable', 'origin': 'paramétrage', 'remark': '', 'param_id': 'dates_2025-05-11_00:00'}
2025-02-24 12:53:36,184 - DEBUG - Vignette Fermeture générée: {'date': '2025-05-11', 'start': '', 'end': '17:00', 'duration': '17:00', 'category': 'General', 'activity': 'Fermeture au public', 'place': 'Controle', 'department': 'SAFE', 'type': 'Timetable', 'origin': 'paramétrage', 'remark': '', 'param_id': 'dates_2025-05-11_00:00'}
2025-02-24 12:53:36,659 - DEBUG - {"topologyId": {"$oid": "67bc5dc0460e93dfa834a3f9"}, "serverHost": "localhost", "serverPort": 27017, "awaited": true, "durationMS": 501.9331001676619, "failure": "\"_OperationCancelled('operation cancelled')\"", "message": "Server heartbeat failed"}
