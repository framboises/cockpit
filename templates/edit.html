<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>COCKPIT — Configuration des tâches</title>

  <!-- mêmes libs que index.html pour la cohérence visuelle -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="body-without-sidebar single-col-page">
  <!-- Topbar (même markup que index.html, version courte) -->
  <div id="search-box">
    <button id="hamburger-button"><i class="material-icons">menu</i></button>
    <div id="left-section"></div>
    <div id="right-section">
      <div id="meteo-previsions" class="meteo-container"></div>
      <img id="logo" src="{{ url_for('static', filename='img/ACO-logo-monochrome-universel-blanc.png') }}" alt="Logo ACO">
    </div>
  </div>

  <!-- Sidebar (copiée de index.html) -->
  <div id="sidebar">
    <ul>
      <li>
        <a href="http://safe.lemans.org/home">
          <i class="fa fa-tachometer-alt"></i> Tableaux de bord
        </a>
      </li>
      <li>
        <a href="/">
        <span class="material-icons">dashboard</span> Cockpit
        </a>
      </li>
      <li>
        <label for="event-select" style="color:#ccc;font-size:16px;">Événement</label>
        <select id="event-select" style="width:90%;margin-top:5px;"></select>
      </li>
      <li>
        <label for="year-select" style="color:#ccc;font-size:16px;">Année</label>
        <select id="year-select" style="width:90%;margin-top:5px;"></select>
      </li>
      <li>
        <a href="/logout_redirect" style="color:red;">
          <i class="fa fa-sign-out-alt"></i> Se déconnecter
        </a>
      </li>
    </ul>
  </div>

  <!-- Contenu principal : notre CRUD -->
  <div id="main-content">
    <section class="widget-card">
      <header class="widget-header">
        <h3>Configuration — Tâches automatiques par catégorie</h3>
      </header>
      <div class="widget-body">
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
          <button id="btn-add" class="btn btn-primary">+ Nouveau type</button>
          <button id="btn-delete-selected" class="btn btn-danger">Supprimer la sélection</button>
          <label style="margin-left:auto; color:#ccc;">Filtrer
            <input id="filter-type" type="search" placeholder="portes, terrains, tribunes…" />
          </label>
        </div>

        <div class="table-responsive">
          <table id="todo-sets-table" class="table table-striped table-hover">
            <thead>
              <tr>
                <th style="width:36px"><input type="checkbox" id="check-all"></th>
                <th>Type</th>
                <th>Tâches (aperçu)</th>
                <th style="width:140px">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <!-- Flash messages (même logique que index.html) -->
  <div id="flash-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-popup {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!-- Footer -->
  <footer>
    TITAN - Techniques d'Intégration Topographique avec Navigation
  </footer>

  <!-- Modale CRUD (classe dédiée pour éviter tout conflit) -->
  <div id="todo-set-modal" class="crud-modal" hidden>
    <div class="crud-modal-dialog">
      <div class="crud-modal-header">
        <h3 id="modal-title">Nouveau type</h3>
        <button class="crud-modal-close" data-close>&times;</button>
      </div>
      <div class="crud-modal-body">
        <form id="todo-set-form">
          <input type="hidden" name="_id" />
          <div class="form-row">
            <label>Type (catégorie)
              <input name="type" required placeholder="ex. tribunes" />
            </label>
          </div>
          <label>Tâches (1 par ligne)
            <textarea name="todos" rows="10" placeholder="Vérifier présence du personnel&#10;Vérifier fonctionnement des PDA"></textarea>
          </label>
        </form>
      </div>
      <div class="crud-modal-footer">
        <button class="btn" data-close>Annuler</button>
        <button id="modal-save" class="btn btn-primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Script CRUD -->
  <script src="/static/js/todo_sets.js"></script>
  <script src="/static/js/main.js"></script>
</body>
</html>